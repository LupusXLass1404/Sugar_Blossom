<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sugar Blossom</title>

    <!-- favicon -->
    <link rel="icon" type="image/x-icon" href="./images/favicon.ico">

    <!-- reset css -->
    <link rel="stylesheet" href="./css/reset.css">

    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <!-- bootstrap@5.3.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <!-- font Awesome -->
    <script src="https://kit.fontawesome.com/a3ca2244ae.js" crossorigin="anonymous"></script>

    <!-- css -->
    <link rel="stylesheet" href="./css/style.css">
    <script src="./js/js.js"></script>
</head>

<body>
    <!-- ====================== Menu Start ====================== -->
    <section id="menu">
        <div class="container-fluid py-5">
            <div id="accordion" class="row">
                <div class="accordion-item">
                    <img src="./images/default.jpg" alt="">蛋糕
                </div>

                <div class="accordion-item">
                    <img class="accordion-img" src="./images/default.jpg" data-default="./images/default.jpg">
                    <h4>
                        ｜餅乾｜
                        <br>
                        看更多
                    </h4>
                    <div class="accordion-close"><i class="fa-solid fa-xmark"></i></div>
                    <div class="accordion-gallery">
                        <div class="gallery-content"></div>
                        <div class="gallery-backdrop">
                            <button class="gallery-button">
                                <img src="./upload/03B01.png" alt="">
                            </button>
                            <button class="gallery-button">
                                <img src="./upload/03B04.png" alt="">
                            </button>
                            <button class="gallery-button">
                                <img src="./upload/03B08.png" alt="">
                            </button>
                            <button class="gallery-button">
                                <img src="./upload/03B12.png" alt="">
                            </button>
                        </div>
                    </div>
                </div>
                <div class="accordion-item"> <img src="./images/default.jpg" alt="">｜馬卡龍｜</div>
                <!-- <div class="accordion-item"> <img src="./images/default.jpg" alt="">｜酥皮、塔｜</div>
                <div class="accordion-item"> <img src="./images/default.jpg" alt="">｜酥皮、塔｜</div> -->
            </div>
        </div>
    </section>

    <script>
        // ====================== function ======================

        function accordionEvent(event) {
            // closest 找到父元素中的 .accordion-item
            const item = event.target.closest('.accordion-item')

            // 確保 item 有值且檢查是否是 .accordion 的子元素，不是的話結束函數
            if (!(item && accordionId.contains(item))) return;

            switch (event.type) {
                case 'mouseover':
                    hoverAccordionItem(item);
                    break;
                case 'mouseout':
                    resetAccordion('hover');
                    break;
                case 'click':
                    if (event.target.closest('.accordion-close')) {
                        // 關閉手風琴
                        closeAccordion(item);
                    } else if (event.target.closest('.gallery-button')) {
                        // 畫廊圖片點擊
                        const button = event.target.closest('.gallery-button')
                        clickGallery(item, button);
                    } else {
                        clickAccordionItem(item);
                    }
                    break;
            }
        }

        function hoverAccordionItem(e) {
            // 當 hover 時，加上 hover 類別
            if (!e.classList.contains('active')) {
                e.classList.add('hover');
                const img = e.querySelector('img');
                img.classList.add('hover');
            }
        }

        function clickAccordionItem(e) {
            // const prevActive = accordionId.querySelector('.accordion-item.active');
            // if (prevActive) closeAccordion(prevActive);
            closeAccordion();
            e.classList.add('active');
            const img = e.querySelector('img');

            img.classList.add('active');
            // const close = e.querySelector('.accordion-close');
            // show(close);
            // const gallery = e.querySelector('.accordion-gallery');
            // show(gallery);
        }

        // 關閉展開的手風琴
        function closeAccordion(e) {
            // 隱藏所有的畫廊
            hideGallery();
            // 點擊時，將 active 類別添加到被點擊的項目，並移除其他項目的 active 類別
            resetAccordion('active');
            // const img = e.querySelector('.accordion-img');
            // img.src = img.dataset.default;
        }

        function clickGallery(e, sw) {
            console.log(e);
            const mainImg = e.querySelector('.accordion-img');
            const swImg = sw.querySelector('img');
            // 換主圖的圖片
            mainImg.src = swImg.src;
        }

        // 重置 hover 或 active 類別
        function resetAccordion(className) {
            accordionItem.forEach(item => {
                item.classList.remove(className);
                const img = item.querySelector('img');
                img.classList.remove(className);
            });
        }

        // 隱藏所有的畫廊
        function hideGallery() {
            const galleryClass = document.querySelectorAll('.accordion-gallery');
            galleryClass.forEach(item => {
                hide(item);
            })
        }

        // 顯示物件
        function show(item) {
            item.style.display = 'block';
        }
        // 隱藏物件
        function hide(item) {
            item.style.display = 'none';
        }

        // ====================== declaration ======================
        const accordionId = document.getElementById('accordion')
        const accordionItem = document.querySelectorAll('.accordion-item');
        const accordionClose = document.querySelectorAll('.accordion-close');

        // ====================== binding ======================

        // 監聽進入、離開、點擊事件
        ['mouseover', 'mouseout', 'click'].forEach(eventType => {
            accordionId.addEventListener(eventType, accordionEvent);
        });


    </script>

    <!-- Menu End -->

</body>

</html>